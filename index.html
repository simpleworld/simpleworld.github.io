<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Browser FPS Full</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#000;font-family:Arial}
#crosshair{
 position:fixed;left:50%;top:50%;width:20px;height:20px;
 margin:-10px 0 0 -10px;pointer-events:none
}
#crosshair:before,#crosshair:after{
 content:"";position:absolute;background:#0f0
}
#crosshair:before{width:20px;height:2px;top:9px;left:0}
#crosshair:after{width:2px;height:20px;left:9px;top:0}

#hud{
 position:fixed;bottom:10px;left:10px;color:#fff;font-size:14px
}
#weapons{
 position:fixed;bottom:10px;right:10px;display:flex;gap:10px
}
.weapon{padding:8px 12px;border:2px solid #555;color:#aaa}
.weapon.active{border-color:#0f0;color:#0f0;transform:scale(1.2)}

#fps{position:fixed;top:10px;right:10px;color:#0f0}
#start{
 position:fixed;inset:0;display:flex;align-items:center;
 justify-content:center;background:rgba(0,0,0,.9);
 color:#fff;font-size:24px;cursor:pointer
}
</style>
</head>
<body>

<div id="crosshair"></div>
<div id="hud">
 Weapon: <span id="weaponName">AK-47</span><br>
 Enemies: <span id="enemyCount">0</span>
</div>

<div id="weapons">
 <div class="weapon active" id="w1">AK</div>
 <div class="weapon" id="w2">GLOCK</div>
 <div class="weapon" id="w3">KNIFE</div>
</div>

<div id="fps">FPS: 0</div>
<div id="start">CLICK TO START</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* ================= BASIC ================= */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87ceeb);

const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
camera.position.set(0,1.7,5);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

/* ================= LIGHT ================= */
scene.add(new THREE.AmbientLight(0xffffff,0.4));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(10,20,10);
scene.add(sun);

/* ================= MAP ================= */
const floor=new THREE.Mesh(
 new THREE.PlaneGeometry(300,300),
 new THREE.MeshStandardMaterial({color:0x444444})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

const buildings=[];
for(let i=0;i<40;i++){
 const h=Math.random()*8+3;
 const b=new THREE.Mesh(
  new THREE.BoxGeometry(5,h,5),
  new THREE.MeshStandardMaterial({color:0x888888})
 );
 b.position.set((Math.random()-0.5)*120,h/2,(Math.random()-0.5)*120);
 buildings.push(b);
 scene.add(b);
}

function collide(pos){
 for(const b of buildings){
  const box=new THREE.Box3().setFromObject(b);
  if(box.containsPoint(pos)) return true;
 }
 return false;
}

/* ================= INPUT ================= */
let keys={},yaw=0,pitch=0;
document.addEventListener("keydown",e=>keys[e.code]=true);
document.addEventListener("keyup",e=>keys[e.code]=false);

document.addEventListener("mousemove",e=>{
 if(document.pointerLockElement){
  yaw-=e.movementX*0.002;
  pitch-=e.movementY*0.002;
  pitch=Math.max(-1.5,Math.min(1.5,pitch));
 }
});

/* ================= HANDS ================= */
const hands=new THREE.Group();
camera.add(hands);
scene.add(camera);

function createHands(){
 const mat=new THREE.MeshStandardMaterial({color:0xffccaa});
 const left=new THREE.Mesh(new THREE.CylinderGeometry(0.08,0.1,0.6,16),mat);
 const right=new THREE.Mesh(new THREE.CylinderGeometry(0.08,0.1,0.6,16),mat);
 left.rotation.z=0.4;
 right.rotation.z=-0.4;
 left.position.set(-0.25,-0.5,-0.6);
 right.position.set(0.25,-0.5,-0.6);
 hands.add(left,right);
}
createHands();

/* ================= WEAPONS ================= */
let weapon=1;
const names={1:"AK-47",2:"Glock",3:"Knife"};
const weaponGroup=new THREE.Group();
camera.add(weaponGroup);

function clearWeapon(){
 while(weaponGroup.children.length)
  weaponGroup.remove(weaponGroup.children[0]);
}

function AK(){
 const g=new THREE.Group();
 const body=new THREE.Mesh(new THREE.BoxGeometry(0.6,0.25,2),new THREE.MeshStandardMaterial({color:0x222}));
 const mag=new THREE.Mesh(new THREE.BoxGeometry(0.25,0.4,0.4),new THREE.MeshStandardMaterial({color:0x111}));
 const stock=new THREE.Mesh(new THREE.BoxGeometry(0.3,0.25,0.6),new THREE.MeshStandardMaterial({color:0x333}));
 mag.position.set(0,-0.3,0.3);
 stock.position.set(0,0,-1.1);
 g.add(body,mag,stock);
 g.position.set(0.4,-0.4,-1);
 return g;
}

function Glock(){
 const g=new THREE.Group();
 const body=new THREE.Mesh(new THREE.BoxGeometry(0.4,0.2,1),new THREE.MeshStandardMaterial({color:0x333}));
 const grip=new THREE.Mesh(new THREE.BoxGeometry(0.25,0.4,0.25),new THREE.MeshStandardMaterial({color:0x222}));
 grip.position.set(0,-0.3,0.2);
 g.add(body,grip);
 g.position.set(0.4,-0.4,-0.9);
 return g;
}

function Knife(){
 const g=new THREE.Group();
 const blade=new THREE.Mesh(new THREE.BoxGeometry(0.05,0.05,1),new THREE.MeshStandardMaterial({color:0xddd}));
 const handle=new THREE.Mesh(new THREE.BoxGeometry(0.15,0.1,0.3),new THREE.MeshStandardMaterial({color:0x222}));
 handle.position.z=0.65;
 g.add(blade,handle);
 g.position.set(0.3,-0.4,-0.7);
 return g;
}

function equip(){
 clearWeapon();
 if(weapon===1) weaponGroup.add(AK());
 if(weapon===2) weaponGroup.add(Glock());
 if(weapon===3) weaponGroup.add(Knife());
 document.getElementById("weaponName").textContent=names[weapon];
 document.querySelectorAll(".weapon").forEach(w=>w.classList.remove("active"));
 document.getElementById("w"+weapon).classList.add("active");
}
equip();

document.addEventListener("keydown",e=>{
 if(e.code==="Digit1") weapon=1;
 if(e.code==="Digit2") weapon=2;
 if(e.code==="Digit3") weapon=3;
 equip();
});

/* ================= BOTS ================= */
const bots=[];
function createBot(x,z){
 const g=new THREE.Group();
 const body=new THREE.Mesh(new THREE.CapsuleGeometry(0.4,1.2,4,8),
  new THREE.MeshStandardMaterial({color:0xff0000}));
 body.position.y=1;
 g.add(body);
 g.position.set(x,0,z);
 g.hp=100;
 scene.add(g);
 bots.push(g);
}
for(let i=0;i<8;i++)
 createBot((Math.random()-0.5)*80,(Math.random()-0.5)*80);

/* ================= SHOOTING ================= */
let shooting=false,lastShot=0;
const raycaster=new THREE.Raycaster();

document.addEventListener("mousedown",()=>shooting=true);
document.addEventListener("mouseup",()=>shooting=false);

function tracer(from,to){
 const geo=new THREE.BufferGeometry().setFromPoints([from,to]);
 const mat=new THREE.LineBasicMaterial({color:0xffff00});
 const line=new THREE.Line(geo,mat);
 scene.add(line);
 setTimeout(()=>scene.remove(line),80);
}

function fire(){
 pitch+=weapon===1?0.03:0.015;
 raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
 const targets=[...bots,...buildings];
 const hit=raycaster.intersectObjects(targets,true)[0];
 let end=camera.position.clone().add(camera.getWorldDirection(new THREE.Vector3()).multiplyScalar(50));
 if(hit){
  end=hit.point;
  if(bots.includes(hit.object.parent)){
   const bot=hit.object.parent;
   bot.hp-=weapon===3?50:30;
   bot.children[0].material.color.setHSL(bot.hp/100,1,0.5);
   if(bot.hp<=0){
    scene.remove(bot);
    bots.splice(bots.indexOf(bot),1);
   }
  }
 }
 tracer(camera.position.clone(),end);
}

/* ================= LOOP ================= */
let last=performance.now(),fps=0,fpst=0;
function animate(){
 requestAnimationFrame(animate);
 const now=performance.now();
 const dt=(now-last)/1000;
 last=now;

 fps++;fpst+=dt;
 if(fpst>1){document.getElementById("fps").textContent="FPS: "+fps;fps=0;fpst=0}

 let dir=new THREE.Vector3();
 if(keys["KeyW"]) dir.z-=1;
 if(keys["KeyS"]) dir.z+=1;
 if(keys["KeyA"]) dir.x-=1;
 if(keys["KeyD"]) dir.x+=1;
 dir.normalize().applyAxisAngle(new THREE.Vector3(0,1,0),yaw);

 const next=camera.position.clone().add(dir.multiplyScalar(dt*6));
 if(!collide(next)) camera.position.copy(next);

 camera.rotation.order="YXZ";
 camera.rotation.y=yaw;
 camera.rotation.x=pitch;

 weaponGroup.rotation.z=Math.sin(now*0.005)*0.03;
 hands.position.y=Math.sin(now*0.01)*0.03;

 if(shooting){
  if(weapon===1 && now-lastShot>100){fire();lastShot=now;}
  if(weapon===2 && now-lastShot>300){fire();lastShot=now;}
  if(weapon===3 && now-lastShot>500){fire();lastShot=now;}
 }

 bots.forEach(b=>{
  const dir=camera.position.clone().sub(b.position);
  if(dir.length()<40){
   dir.normalize();
   b.position.add(dir.multiplyScalar(dt*1.5));
  }
 });

 document.getElementById("enemyCount").textContent=bots.length;
 renderer.render(scene,camera);
}
animate();

/* ================= START ================= */
document.getElementById("start").onclick=()=>{
 document.body.requestPointerLock();
 document.getElementById("start").style.display="none";
};

window.onresize=()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
};
</script>
</body>
</html>
