<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Web FPS Shooter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#000;font-family:Arial}
#ui{position:fixed;inset:0;pointer-events:none}
#crosshair{
position:absolute;left:50%;top:50%;
width:20px;height:20px;
margin-left:-10px;margin-top:-10px;
}
#crosshair:before,#crosshair:after{
content:"";position:absolute;background:#fff
}
#crosshair:before{left:9px;top:0;width:2px;height:20px}
#crosshair:after{top:9px;left:0;width:20px;height:2px}

#mobile{
position:absolute;inset:0;display:none;pointer-events:auto
}
.joy{
position:absolute;width:120px;height:120px;
border-radius:50%;background:rgba(255,255,255,.1);
border:2px solid rgba(255,255,255,.3)
}
.knob{
width:40px;height:40px;border-radius:50%;
background:rgba(255,255,255,.6);
position:absolute;left:40px;top:40px
}
#moveJoy{left:20px;bottom:20px}
#lookJoy{right:20px;bottom:20px}
#fireBtn{
position:absolute;right:30px;bottom:180px;
width:80px;height:80px;border-radius:50%;
background:rgba(255,0,0,.4);
border:2px solid #fff;color:#fff;font-size:14px
}
</style>
</head>
<body>

<div id="ui">
  <div id="crosshair"></div>
  <div id="mobile">
    <div id="moveJoy" class="joy"><div class="knob"></div></div>
    <div id="lookJoy" class="joy"><div class="knob"></div></div>
    <button id="fireBtn">FIRE</button>
  </div>
</div>

<script src="https://cdn.babylonjs.com/babylon.js"></script>

<script>
/* =========================
   BASIC SETUP
========================= */
const canvas = document.createElement("canvas");
canvas.style.width="100%";canvas.style.height="100%";
document.body.appendChild(canvas);

const engine = new BABYLON.Engine(canvas,true);
const scene = new BABYLON.Scene(engine);
scene.clearColor = new BABYLON.Color3(0.5,0.7,1);

/* =========================
   LIGHT + GROUND
========================= */
const light = new BABYLON.HemisphericLight("l",new BABYLON.Vector3(0,1,0),scene);
light.intensity = 0.9;

const ground = BABYLON.MeshBuilder.CreateGround("g",{width:200,height:200},scene);
const gmat = new BABYLON.StandardMaterial("gm",scene);
gmat.diffuseColor = new BABYLON.Color3(0.2,0.6,0.2);
ground.material = gmat;

/* =========================
   PLAYER + CAMERA
========================= */
const camera = new BABYLON.UniversalCamera("cam",new BABYLON.Vector3(0,2,0),scene);
camera.attachControl(canvas,true);
camera.speed = 0.4;
camera.angularSensibility = 4000;
camera.minZ = 0.1;
scene.activeCamera = camera;

/* =========================
   SIMPLE MAP
========================= */
for(let i=0;i<20;i++){
 let box = BABYLON.MeshBuilder.CreateBox("b",{size:3},scene);
 box.position.set(
  Math.random()*100-50,
  1.5,
  Math.random()*100-50
 );
}

/* =========================
   INPUT
========================= */
const keys = {};
window.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
window.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

/* =========================
   MOBILE DETECT
========================= */
const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
if(isMobile){
 document.getElementById("mobile").style.display="block";
}

/* =========================
   JOYSTICKS
========================= */
let moveVec={x:0,y:0},lookVec={x:0,y:0};

function setupJoy(id,vec){
 const joy=document.getElementById(id);
 const knob=joy.querySelector(".knob");
 let active=false,start={x:0,y:0};
 joy.addEventListener("touchstart",e=>{
  active=true;
  start.x=e.touches[0].clientX;
  start.y=e.touches[0].clientY;
 });
 joy.addEventListener("touchmove",e=>{
  if(!active)return;
  let dx=e.touches[0].clientX-start.x;
  let dy=e.touches[0].clientY-start.y;
  dx=Math.max(-40,Math.min(40,dx));
  dy=Math.max(-40,Math.min(40,dy));
  knob.style.left=40+dx+"px";
  knob.style.top=40+dy+"px";
  vec.x=dx/40;vec.y=dy/40;
 });
 joy.addEventListener("touchend",()=>{
  active=false;
  knob.style.left="40px";knob.style.top="40px";
  vec.x=0;vec.y=0;
 });
}

if(isMobile){
 setupJoy("moveJoy",moveVec);
 setupJoy("lookJoy",lookVec);
}

/* =========================
   SHOOTING
========================= */
let canShoot=true;

function shoot(){
 if(!canShoot)return;
 canShoot=false;
 setTimeout(()=>canShoot=true,120);

 const ray = camera.getForwardRay(100);
 const hit = scene.pickWithRay(ray,m=>m.name==="bot");
 if(hit.hit){
  hit.pickedMesh.health-=50;
  if(hit.pickedMesh.health<=0){
   hit.pickedMesh.dispose();
  }
 }
}

window.addEventListener("mousedown",()=>!isMobile && shoot());
if(isMobile){
 document.getElementById("fireBtn").onclick=shoot;
}

/* =========================
   BOTS
========================= */
function spawnBot(){
 const bot = BABYLON.MeshBuilder.CreateBox("bot",{size:2},scene);
 bot.position.set(Math.random()*80-40,1,Math.random()*80-40);
 bot.health=100;
 setInterval(()=>{
  if(!bot.isDisposed()){
   const dir=camera.position.subtract(bot.position).normalize();
   bot.position.addInPlace(dir.scale(0.03));
  }
 },50);
}
setInterval(spawnBot,3000);

/* =========================
   GAME LOOP
========================= */
scene.onBeforeRenderObservable.add(()=>{
 if(!isMobile){
  let forward=(keys["w"]?1:0)-(keys["s"]?1:0);
  let side=(keys["d"]?1:0)-(keys["a"]?1:0);
  camera.moveWithCollisions(
   camera.getDirection(new BABYLON.Vector3(side,0,forward)).scale(0.2)
  );
 }else{
  camera.rotation.y+=lookVec.x*0.05;
  camera.rotation.x+=lookVec.y*0.05;
  camera.moveWithCollisions(
   camera.getDirection(new BABYLON.Vector3(moveVec.x,0,moveVec.y)).scale(0.15)
  );
 }
});

/* =========================
   RUN
========================= */
engine.runRenderLoop(()=>scene.render());
window.addEventListener("resize",()=>engine.resize());
</script>

</body>
</html>
