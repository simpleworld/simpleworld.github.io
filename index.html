<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ü¶äFoxDrop ‚Äî –ø–æ–≤–Ω–∞ –≤–µ—Ä—Å—ñ—è</title>
<style>
  :root{--bg:#0d0e11;--accent:#ff8800;--card:#16181d;--muted:#9aa4b2}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#07080a,#0d0e11);color:#eef2f7}
  header{background:var(--card);display:flex;justify-content:space-between;align-items:center;padding:16px 28px;border-bottom:2px solid var(--accent)}
  header h1{color:var(--accent);margin:0}
  .balance{background:#111418;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)}
  nav{display:flex;gap:12px;padding:12px 28px;background:#0f1114}
  nav a{color:#cfd8df;text-decoration:none;padding:8px 12px;border-radius:8px}
  nav a.active{background:var(--accent);color:#07121a}
  .wrap{max-width:1100px;margin:20px auto;padding:0 18px}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
  .panel{background:#0f1317;padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .cases{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  .case{background:linear-gradient(180deg,#14171a,#0f1317);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);text-align:center}
  .case img{width:100%;height:150px;object-fit:cover;border-radius:10px}
  .case h3{margin:8px 0 4px 0}
  .case .price{color:var(--muted);font-size:13px}
  .btn{background:linear-gradient(90deg,var(--accent),#ffb176);border:none;padding:8px 12px;border-radius:10px;color:#07121a;font-weight:700;cursor:pointer}
  .btn.small{padding:6px 8px}
  /* opener */
  #opener{display:flex;flex-direction:column;align-items:center;gap:12px}
  .reel-window{width:100%;height:120px;background:#081018;border-radius:10px;overflow:hidden;position:relative;border:1px solid rgba(255,255,255,0.03)}
  .reel{position:absolute;left:0;top:0;display:flex;gap:6px;padding:10px}
  .reel .tile{width:120px;height:100px;background:#0b1b24;border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:6px}
  .reel img{width:100px;height:60px;object-fit:contain;border-radius:6px}
  #pointer{position:absolute;left:50%;top:0;height:100%;width:4px;background:linear-gradient(180deg,#fff8,#fff0);transform:translateX(-50%);box-shadow:0 0 8px rgba(255,255,255,0.06)}
  #resultCard{width:100%;padding:12px;border-radius:10px;background:linear-gradient(90deg,#0b1518,#0d1a1f);display:flex;gap:12px;align-items:center;border:1px solid rgba(255,255,255,0.03)}
  #resultCard img{width:96px;height:60px;object-fit:contain;border-radius:8px}
  /* inventory */
  .inventory-list{display:flex;flex-direction:column;gap:10px}
  .inv-item{display:flex;gap:10px;align-items:center;padding:8px;border-radius:8px;background:#07161a;border:1px solid rgba(255,255,255,0.02)}
  .inv-item img{width:100px;height:56px;object-fit:contain;border-radius:6px}
  .inv-item .meta{flex:1}
  .small{font-size:13px;color:var(--muted)}
  footer{margin:18px 0 60px 0;color:var(--muted);text-align:center}
  @media(max-width:980px){.grid{grid-template-columns:1fr} .cases{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <h1>ü¶ä FoxDrop</h1>
  <div class="balance">–ë–∞–ª–∞–Ω—Å: <strong id="balance">0</strong>$</div>
</header>

<nav>
  <a href="#" id="navCases" class="active" onclick="showPanel('cases')">–ö–µ–π—Å–∏</a>
  <a href="#" id="navInv" onclick="showPanel('inventory')">–Ü–Ω–≤–µ–Ω—Ç–∞—Ä</a>
  <a href="#" onclick="topUp()">–ü–æ–ø–æ–≤–Ω–∏—Ç–∏ +5$</a>
</nav>

<div class="wrap">
  <div class="grid">
    <div>
      <div class="panel" id="casesPanel">
        <h2>–ö–µ–π—Å–∏</h2>
        <div class="cases" id="casesList"></div>
        <div style="margin-top:12px" class="small">ClientSeed: <input id="clientSeed" style="width:260px;padding:6px;border-radius:6px;background:#07121a;border:1px solid rgba(255,255,255,0.04);color:inherit" /></div>
      </div>

      <div class="panel" style="margin-top:12px">
        <h2>–í—ñ–¥–∫—Ä–∏–≤–∞–Ω–Ω—è –∫–µ–π—Å—É</h2>
        <div id="opener">
          <div class="reel-window" id="reelWindow">
            <div id="pointer"></div>
            <div class="reel" id="reel"></div>
          </div>
          <div style="display:flex;gap:8px;width:100%">
            <button class="btn" id="openBtn" onclick="openSelected()">Open</button>
            <button class="btn small" onclick="autoOpen(5)">Auto √ó5</button>
            <button class="btn small" onclick="generateSeed()">Gen seed</button>
          </div>
          <div id="resultCardArea"></div>
        </div>
      </div>
    </div>

    <aside>
      <div class="panel" id="inventoryPanel" style="display:none">
        <h3>–Ü–Ω–≤–µ–Ω—Ç–∞—Ä</h3>
        <div class="inventory-list" id="inventoryList"></div>
      </div>

      <div class="panel" style="margin-top:12px">
        <h3>–ê–∫—Ç–∏–≤–Ω–∏–π –∫–µ–π—Å</h3>
        <div id="activeCaseCard" style="display:flex;gap:12px;align-items:center">
          <img id="activeCaseImg" src="" alt="" style="width:100px;height:70px;object-fit:cover;border-radius:8px"/>
          <div>
            <div id="activeCaseName" style="font-weight:700">-</div>
            <div class="small" id="activeCasePrice">-</div>
            <div style="margin-top:8px"><button class="btn small" onclick="openSelected()">Open</button></div>
          </div>
        </div>
        <div style="margin-top:12px" class="small">–û—Å—Ç–∞–Ω–Ω—ñ: <div id="recent" style="margin-top:6px;color:var(--muted)"></div></div>
      </div>
    </aside>
  </div>

  <footer>FoxDrop demo ‚Äî —Å–∫–æ–ø—ñ—é–π –∫–æ–¥, –Ω–∞–ª–∞—à—Ç—É–π —à–ª—è—Ö–∏ –¥–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫, –ø—ñ–¥–∫–ª—é—á–∏ –±–µ–∫–µ–Ω–¥ –¥–ª—è —Ä–µ–∞–ª—å–Ω–∏—Ö —Ü—ñ–Ω</footer>
</div>

<script>
/* ========= SKIN TEMPLATES (–∫–æ–ø—ñ—é–π –ø–æ–≤–Ω—ñ—Å—Ç—é –≤ —Å–≤—ñ–π –∫–æ–¥ —è–∫—â–æ —Ç—Ä–µ–±–∞) =========
   –ù–∏–∂—á–µ ‚Äî –ø–æ–º—ñ—Ä–Ω–∏–π –Ω–∞–±—ñ—Ä —Å–∫—ñ–Ω—ñ–≤ —É —Ñ–æ—Ä–º–∞—Ç—ñ {name, price, img}
   –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤–∏–±—Ä–∞–Ω—ñ –∑ Steam CDN / –ø—É–±–ª—ñ—á–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª, —è–∫—â–æ —â–æ—Å—å –Ω–µ –≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è ‚Äî –∑–∞–º—ñ–Ω–∏ URL.
*/

// AK-47
const akSkins = [
  {name: "AK-47 | Redline", price: 45, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_ak47_cu_ak47_redline_light_large.1baf2652.png"},
  {name: "AK-47 | Vulcan", price: 320, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_ak47_cu_ak47_vulcan_light_large.c6e2e6b6.png"},
  {name: "AK-47 | Neon Rider", price: 400, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_ak47_cu_ak_neon_rider_light_large.60264f23.png"},
  {name: "AK-47 | The Empress", price: 600, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_ak47_cu_ak47_empress_light_large.5e4d3c2b.png"},
  {name: "AK-47 | Fuel Injector", price: 420, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_ak47_cu_fuel_injector_light_large.1c2d3e4f.png"}
];

// AWP
const awpSkins = [
  {name: "AWP | Dragon Lore", price: 3500, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_awp_cu_awp_dragon_lore_light_large.48c95fa1.png"},
  {name: "AWP | Medusa", price: 980, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_awp_cu_medusa_awp_light_large.20e0a21d.png"},
  {name: "AWP | Asiimov", price: 380, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_awp_cu_awp_asiimov_light_large.9dcb3f4f.png"},
  {name: "AWP | Graphite", price: 45, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_awp_cu_awp_graphite_light_large.2d3c4b5a.png"}
];

// Knife
const knifeSkins = [
  {name: "Butterfly Knife | Fade", price: 1200, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_knife_butterfly_am_zebra_light_large.1b4936ee.png"},
  {name: "Karambit | Doppler", price: 1800, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_knife_karambit_am_doppler_phase2_light_large.3ccf56ee.png"},
  {name: "M9 Bayonet | Marble Fade", price: 1500, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_knife_m9_bayonet_am_marble_fade_light_large.07f86e9c.png"},
  {name: "Flip Knife | Slaughter", price: 700, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_knife_flip_am_slaughter_light_large.4f3e2d1c.png"}
];

// USP-S
const uspSkins = [
  {name: "USP-S | Kill Confirmed", price: 220, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_usp_silencer_cu_usp_kill_confirmed_light_large.32ac7d8b.png"},
  {name: "USP-S | Orion", price: 150, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_usp_silencer_cu_orion_light_large.77bda123.png"},
  {name: "USP-S | Neo-Noir", price: 420, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_usp_silencer_cu_usp_neonoir_light_large.4e3d2c1b.png"}
];

// M4A4
const m4a4Skins = [
  {name: "M4A4 | Howl", price: 850, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_m4a4_cu_m4a4_howl_light_large.76b0c72b.png"},
  {name: "M4A4 | Desolate Space", price: 220, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_m4a4_cu_m4a4_desolate_space_light_large.55a0ef2a.png"},
  {name: "M4A4 | Neo-Noir", price: 290, img: "https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/weapon_m4a4_cu_m4a4_neo_noir_light_large.6f5e4d3c.png"}
];

// Map of case types to arrays
const skinsMap = {
  ak: akSkins,
  awp: awpSkins,
  knife: knifeSkins,
  usp: uspSkins,
  m4a4: m4a4Skins
};

/* ========= APPLICATION LOGIC ========= */

const CASES = [
  {id:'c1', name:'AK-47 Case', price:100, type:'ak', image:'https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/weapon_cases/case_community_10.7bfa40c5b5b2213b657b1b8ab.png'},
  {id:'c2', name:'Knife Case', price:350, type:'knife', image:'https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/weapon_cases/case_community_15.4e52f19b32472.png'},
  {id:'c3', name:'AWP Case', price:200, type:'awp', image:'https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/weapon_cases/case_community_20.4e53fa19b14.png'},
  {id:'c4', name:'USP-S Case', price:80, type:'usp', image:'https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/weapon_cases/case_community_17.15e0b2f.png'},
  {id:'c5', name:'M4A4 Case', price:120, type:'m4a4', image:'https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/weapon_cases/case_community_21.12ebcfb3b0.png'}
];

let state = {
  balance: parseInt(localStorage.getItem('fd_balance')) || 50,
  inventory: JSON.parse(localStorage.getItem('fd_inventory')||'[]'),
  clientSeed: localStorage.getItem('fd_clientSeed') || ''
};

const el = {
  casesList: document.getElementById('casesList'),
  activeCaseImg: document.getElementById('activeCaseImg'),
  activeCaseName: document.getElementById('activeCaseName'),
  activeCasePrice: document.getElementById('activeCasePrice'),
  balance: document.getElementById('balance'),
  reel: document.getElementById('reel'),
  resultCardArea: document.getElementById('resultCardArea'),
  inventoryList: document.getElementById('inventoryList'),
  clientSeedInput: document.getElementById('clientSeed'),
  recent: document.getElementById('recent')
};

el.balance.innerText = state.balance;
el.clientSeedInput.value = state.clientSeed;

let selectedCase = CASES[0];
let spinning = false;
let recentList = JSON.parse(localStorage.getItem('fd_recent')||'[]');

function saveAll(){
  localStorage.setItem('fd_balance', String(state.balance));
  localStorage.setItem('fd_inventory', JSON.stringify(state.inventory));
  localStorage.setItem('fd_clientSeed', state.clientSeed);
  localStorage.setItem('fd_recent', JSON.stringify(recentList));
}

function renderCases(){
  el.casesList.innerHTML = '';
  CASES.forEach(c=>{
    const d = document.createElement('div'); d.className='case';
    d.innerHTML = `
      <img src="${c.image}" alt="${c.name}">
      <h3>${c.name}</h3>
      <div class="price">–¶—ñ–Ω–∞: ${c.price}$</div>
      <div style="margin-top:8px"><button class="btn small" onclick="selectCase('${c.id}')">Select</button></div>
    `;
    el.casesList.appendChild(d);
  });
  selectCase(selectedCase.id);
}
renderCases();

function selectCase(id){
  const c = CASES.find(x=>x.id===id);
  if(!c) return;
  selectedCase = c;
  el.activeCaseImg.src = c.image;
  el.activeCaseName.innerText = c.name;
  el.activeCasePrice.innerText = '–¶—ñ–Ω–∞: ' + c.price + '$';
}

function generateSeed(){
  state.clientSeed = 'cs_' + Math.random().toString(36).slice(2) + Date.now().toString(36);
  el.clientSeedInput.value = state.clientSeed;
  saveAll();
}

el.clientSeedInput.onchange = ()=>{ state.clientSeed = el.clientSeedInput.value; saveAll(); }

function topUp(){
  state.balance += 5; el.balance.innerText = state.balance; saveAll();
  alert('+5$ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ (–¥–µ–º–æ)');
}

/* animation helpers */
function buildReelArray(caseType, target) {
  const pool = skinsMap[caseType];
  const arr = [];
  for(let i=0;i<30;i++){
    const pick = pool[Math.floor(Math.random()*pool.length)];
    arr.push(pick);
  }
  // insert target near middle
  const mid = Math.floor(arr.length/2);
  arr[mid] = target;
  return arr;
}

function renderReel(arr){
  el.reel.innerHTML = '';
  arr.forEach(item=>{
    const tile = document.createElement('div'); tile.className = 'tile';
    tile.innerHTML = `<img src="${item.img}" alt="${item.name}"/><div class="small" style="margin-top:6px">${item.name}</div>`;
    el.reel.appendChild(tile);
  });
  // adjust left so first tile visible
  el.reel.style.transform = 'translateX(0px)';
}

/* provably-fair in-browser (deterministic selection) */
async function hmacHex(keyHex, msg){
  // keyHex is hex string (serverSeed); but here we use random serverSeed generated in client for demo
  const keyBytes = hexToBytes(keyHex);
  const cryptoKey = await crypto.subtle.importKey('raw', keyBytes, {name:'HMAC',hash:'SHA-256'}, false, ['sign']);
  const enc = new TextEncoder().encode(msg);
  const sig = await crypto.subtle.sign('HMAC', cryptoKey, enc);
  return Array.from(new Uint8Array(sig)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
function hexToBytes(hex){ const res=[]; for(let i=0;i<hex.length;i+=2) res.push(parseInt(hex.slice(i,i+2),16)); return new Uint8Array(res); }
async function rollFromSeeds(serverSeedHex, clientSeed, nonce=0){
  const msg = `${clientSeed}:${nonce}`;
  const h = await hmacHex(serverSeedHex, msg);
  const slice = h.slice(0,15);
  const num = parseInt(slice,16);
  const max = Math.pow(16, slice.length);
  return num / max;
}

async function openSelected(){
  if(spinning) return;
  if(state.balance < selectedCase.price){ alert('–ù–µ–º–∞—î –±–∞–ª–∞–Ω—Å—É ‚Äî –ø–æ–ø–æ–≤–Ω–∏'); return; }
  spinning = true;
  state.balance -= selectedCase.price; el.balance.innerText = state.balance; saveAll();

  // generate serverSeed (client-side demo). In real server flow server provides serverSeedHash before open and serverSeed after.
  const serverSeed = cryptoRandomHex(32);
  const clientSeed = state.clientSeed || ('cs_demo_' + Date.now().toString(36));
  if(!state.clientSeed){ state.clientSeed = clientSeed; el.clientSeedInput.value = clientSeed; saveAll(); }

  const nonce = (parseInt(localStorage.getItem('fd_nonce')||'0')||0) + 1;
  localStorage.setItem('fd_nonce', String(nonce));

  const pool = skinsMap[selectedCase.type];
  // compute roll -> choose index deterministically
  const roll = await rollFromSeeds(serverSeed, clientSeed, nonce); // 0..1
  const index = Math.floor(roll * pool.length);
  const chosen = pool[index];

  // build reel and animate
  const arr = buildReelArray(selectedCase.type, chosen);
  renderReel(arr);

  // animate: translateX to center chosen tile
  const tiles = el.reel.children;
  // measure tile width+gap
  await sleep(50); // allow layout
  const tileW = tiles[0].offsetWidth + 6; // gap 6
  const centerIndex = Math.floor(arr.length/2);
  const targetIndex = centerIndex; // chosen placed at center
  // add extra spins distance
  const extra = 8 + Math.floor(Math.random()*8);
  const totalShift = -( (targetIndex + extra) * tileW ) + ( (el.reel.parentElement.clientWidth / 2) - (tileW/2) );
  // animate with JS
  el.reel.style.transition = 'transform 3.8s cubic-bezier(.22,.98,.32,1)';
  requestAnimationFrame(()=> el.reel.style.transform = `translateX(${totalShift}px)`);
  setTimeout(()=> {
    // finalize
    el.reel.style.transition = '';
    // give chosen item
    state.inventory.push(Object.assign({}, chosen, {id: 'it_' + Date.now()}));
    recentList.push(new Date().toLocaleTimeString() + ' ‚Äî ' + chosen.name + ' ('+chosen.price+'$)');
    if(recentList.length>20) recentList.shift();
    saveAll();
    showResultCard(chosen, {serverSeed, clientSeed, nonce, roll});
    renderInventory();
    renderRecent();
    spinning = false;
  }, 4100);
}

function showResultCard(item, prov){
  const area = el.resultCardArea;
  area.innerHTML = '';
  const card = document.createElement('div'); card.id='resultCard';
  card.innerHTML = `<img src="${item.img}" alt="${item.name}"/><div><div style="font-weight:800">${item.name}</div><div class="small">–í–∞—Ä—Ç—ñ—Å—Ç—å: ${item.price}$</div>
    <div style="margin-top:8px" class="small">Provably (demo): serverSeed ${prov.serverSeed.slice(0,16)}‚Ä¶ clientSeed ${prov.clientSeed} nonce ${prov.nonce} roll ${prov.roll.toFixed(6)}</div></div>`;
  area.appendChild(card);
}

/* inventory rendering + sell */
function renderInventory(){
  const list = el.inventoryList;
  list.innerHTML = '';
  if(state.inventory.length===0){ list.innerHTML = '<div class="small">–Ü–Ω–≤–µ–Ω—Ç–∞—Ä –ø–æ—Ä–æ–∂–Ω—ñ–π</div>'; return; }
  state.inventory.slice().reverse().forEach((it, idx) => {
    const i = document.createElement('div'); i.className='inv-item';
    i.innerHTML = `<img src="${it.img}" alt="${it.name}"><div class="meta"><div style="font-weight:700">${it.name}</div><div class="small">–¶—ñ–Ω–∞: ${it.price}$</div></div>
      <div><button class="btn small" onclick="sellItem('${it.id}')">–ü—Ä–æ–¥–∞—Ç–∏</button></div>`;
    list.appendChild(i);
  });
}

function sellItem(id){
  const idx = state.inventory.findIndex(x=>x.id===id);
  if(idx===-1) return alert('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
  const item = state.inventory.splice(idx,1)[0];
  // demo: return 80% of price
  const back = Math.round(item.price * 0.8);
  state.balance += back; el.balance.innerText = state.balance;
  saveAll(); renderInventory();
  alert('–ü—Ä–æ–¥–∞–Ω–æ ' + item.name + ' –∑–∞ ' + back + '$ (80%)');
}

/* render recent */
function renderRecent(){ el.recent.innerText = recentList.slice().reverse().slice(0,8).join('\\n'); }

/* panels */
function showPanel(name){
  document.getElementById('casesPanel').style.display = name==='cases' ? 'block' : 'none';
  document.getElementById('inventoryPanel').style.display = name==='inventory' ? 'block' : 'none';
  document.getElementById('navCases').classList.toggle('active', name==='cases');
  document.getElementById('navInv').classList.toggle('active', name==='inventory');
}

/* helpers */
function cryptoRandomHex(bytes=32){
  const arr = new Uint8Array(bytes); crypto.getRandomValues(arr);
  return Array.from(arr).map(b=>b.toString(16).padStart(2,'0')).join('');
}
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

/* init */
renderCases();
renderInventory();
renderRecent();
el.balance.innerText = state.balance;
if(state.clientSeed) el.clientSeedInput.value = state.clientSeed;

/* quick auto open */
async function autoOpen(n){
  for(let i=0;i<n;i++){
    if(state.balance < selectedCase.price) break;
    openSelected();
    await sleep(1400);
  }
}
</script>
</body>
</html>
